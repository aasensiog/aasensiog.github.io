var movements=["1 2 1 2","1 2 3 2","1 2 1 4","1 2 1B 2B","1 2B 3 6","4B 6 2 3","1 1 2","1 2 3 6","1 2 1 4 5","1 2 1 6 5 6"],warning="rgb(100, 100, 0, 0.5)",danger="rgb(100, 0, 0, 0.5)",primary="rgb(0, 0, 100, 0.5)",secondary="rgb(100, 100, 100, 0.5)",grid={1:{pos:"11",badge:primary},2:{pos:"12",badge:primary},3:{pos:"10",badge:danger},4:{pos:"13",badge:danger},5:{pos:"21",badge:warning},6:{pos:"22",badge:warning},7:{pos:"01",badge:"badge-secondary"},8:{pos:"02",badge:"badge-secondary"},"1B":{pos:"41",badge:primary},"2B":{pos:"42",badge:primary},"3B":{pos:"40",badge:danger},"4B":{pos:"43",badge:danger},"5B":{pos:"51",badge:warning},"6B":{pos:"52",badge:warning}},timeleft=0,rest_timeleft=0,reststart_timeleft=0;$(document).ready(function(){var a=function(){var t=document.getElementById("canvas"),e=t.getContext("2d"),n=new Image;t.width=t.width,n.src="/img/boxer.png",e.drawImage(n,0,0,400,800)},s=function(t,e,r,o){($("#text_round_right").html("Rounds left: "+(t-e).toString()),$("#text_round_left").html("Round: "+e.toString()),t<e)?($("#work").hide(),$("#pre").show()):n(r).done(function(){$("#text_movement").html("Rest..."),$("#progressBar").attr("max",o),rest_timeleft=o;var n=setInterval(function(){$("#progressBar").attr("value",o-rest_timeleft);var t=new Date(null);t.setSeconds(rest_timeleft);var e=t.toISOString().substr(11,8);$("#text_countdown").html(e),(rest_timeleft-=1)<=0&&clearInterval(n)},1e3);setTimeout(function(){s(t,e+1,r,o)},1e3*o)})},n=function(t){var e=$.Deferred(),n=60*t;$("#progressBar").attr("max",n),$("#text_movement").html("Fight!"),timeleft=n;var r=setInterval(function(){$("#progressBar").attr("value",n-timeleft);var t=new Date(null);t.setSeconds(timeleft);var e=t.toISOString().substr(11,8);$("#text_countdown").html(e),(timeleft-=1)<=0&&clearInterval(r)},1e3);return o(random_value_from_array(movements),e),e.promise()},o=function(t,e){a(),$("#text_movement").html(t),r(t).done(function(){if(a(),!(0<timeleft))return $("#text_movement").html("Well done!"),void e.resolve();var t=random_value_from_array(movements);$("#text_movement").html("Prepare for..."),setTimeout(function(){$("#text_movement").html(t)},750),setTimeout(function(){o(t,e)},3500)})},r=function(t){var e=$.Deferred(),n=t.split(" "),r=0,o=setInterval(function(){r==n.length?(clearInterval(o),e.resolve()):(a(),function(t){var e=grid[t].pos,n=grid[t].badge,r=document.getElementById("canvas");if(r.getContext){var o=r.getContext("2d");o.fillStyle=n,o.fillRect(100*e[1],100*e[0],100,100),o.fillStyle="rgb(255, 255, 255)",o.font="72px Quicksand",o.fillText(t,100*e[1]+20,10+100*e[0]+50)}}(n[r]),r++)},1e3);return e.promise()},t=document.getElementById("canvas").getContext("2d"),e=new Image;e.src="/img/boxer.png",t.drawImage(e,0,0,400,800),$("#work").hide(),$("#pre").show(),$(".rounds").click(function(){$(".rounds").removeClass("btn-info"),$(this).addClass("btn-info")}),$(".minutes_round").click(function(){$(".minutes_round").removeClass("btn-info"),$(this).addClass("btn-info")}),$(".seconds_rest_between_rounds").click(function(){$(".seconds_rest_between_rounds").removeClass("btn-info"),$(this).addClass("btn-info")}),$(".seconds_before_start").click(function(){$(".seconds_before_start").removeClass("btn-info"),$(this).addClass("btn-info")}),$("#start_btn").click(function(){$("#work").show(),$("#pre").hide();var t=$(".rounds.btn-info").val()||5,e=$(".minutes_round.btn-info").val()||3,n=$(".seconds_rest_between_rounds.btn-info").val()||30,r=$(".seconds_before_start.btn-info").val()||30;$("#text_round_right").html("Rounds left: "+t),$("#text_round_left").html("Round: 0"),$("#text_movement").html("Prepare for start..."),$("#progressBar").attr("max",r),reststart_timeleft=r;var o=setInterval(function(){$("#progressBar").attr("value",r-reststart_timeleft);var t=new Date(null);t.setSeconds(reststart_timeleft);var e=t.toISOString().substr(11,8);$("#text_countdown").html(e),(reststart_timeleft-=1)<=0&&clearInterval(o)},1e3);setTimeout(function(){s(t,1,e,n)},1e3*r)})});var random_value_from_array=function(t){return t[Math.floor(Math.random()*t.length)]};